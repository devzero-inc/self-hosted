kubectl label nodes $(kubectl get nodes -o jsonpath='{.items[0].metadata.name}') katacontainers.io/kata-runtime=true
sudo snap install kata-containers --classic
sudo ln -s /snap/kata-containers/2446/usr/bin/containerd-shim-kata-v2 /opt/kata/bin/containerd-shim-kata-v2
sudo apt update
sudo apt install -y qemu-system-x86
sudo ln -s /usr/bin/qemu-system-x86_64 /opt/kata/bin/qemu-system-x86_64
sudo mkdir -p /opt/kata/share/kata-containers/
sudo ln -s /snap/kata-containers/2446/usr/share/kata-containers/vmlinux.container /opt/kata/share/kata-containers/vmlinux.container
sudo ln -s /snap/kata-containers/2446/usr/share/kata-containers/kata-containers.img /opt/kata/share/kata-containers/kata-containers.img
sudo vim /etc/default/grub
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash systemd.unified_cgroup_hierarchy=0 systemd.legacy_systemd_cgroup_controller"
sudo update-grub
sudo mkdir -p /sys/fs/cgroup/cpu /sys/fs/cgroup/memory /sys/fs/cgroup/devices
sudo mount -t cgroup -o cpu cgroup /sys/fs/cgroup/cpu
sudo mount -t cgroup -o memory cgroup /sys/fs/cgroup/memory
sudo mount -t cgroup -o devices cgroup /sys/fs/cgroup/devices
sudo mkdir -p /opt/kata/libexec/
sudo ln -s /snap/kata-containers/2446/usr/libexec/kata-qemu/virtiofsd /opt/kata/libexec/virtiofsd


sudo systemctl restart containerd
sudo systemctl restart kubelet
sudo reboot